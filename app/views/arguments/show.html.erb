<h1><%= @argument.topic %></h1>
<h4><%= link_to @user1.name, @user1 %> vs. <%= link_to @user2.name, @user2 %></h4>
<br />
<%= render "application/battle" %>

<% if (signed_in? && (@argument.contains(current_user))) %>
	<div class = "hero-unit" style="padding:15px;">
		<h3>Add to your argument</h3>
		<%= form_for @post do |f| %>
			<%= f.hidden_field :user_id, :value => current_user.id %>
			<%= f.hidden_field :argument_id, :value => @argument.id %>
			<%= f.text_field :content %>
			<br />
			<%= link_to_submit "Argue" %>
		<% end %>
	</div>

<script type="text/javascript">
	$(document).ready(function() {
		$('form').submit(function() {
			var valuesToSubmit = $(this).serialize();
			$(this).find('.btn-primary').addClass('disabled');
			$.ajax({
				url: $(this).attr('action'),
				data: valuesToSubmit,
				type: "POST"
			}).complete(function(json) {
				$('#post_content').text("");
				$('.btn-primary').removeClass('disabled');
			});
			return false;
		});
	});
</script>

<% end %>

<script type="text/javascript">
	function fetchPostTable() {
		$.ajax({
			accepts: "text/html",
			url : "<%= @argument.id %>" + "/posts.html"
		}).success(function(html) {
			$("#post_table").html(html);

			setTimeout(fetchPostTable, 1500);
		});
	}

	function fetchFirstPosts() {
		$.ajax({
			accepts: "application/json",
			url : "<%= @argument.id %>" + "/firstposts.json"
		}).success(function(json) {
			$("#player1-text .bubbletext").text(json.u1content);
			$("#player1-text .timestamp").text(json.u1stamp);
			$("#player2-text .bubbletext").text(json.u2content);
			$("#player2-text .timestamp").text(json.u2stamp);

			setTimeout(fetchFirstPosts, 1500);
		});
	}

	$(document).ready(function() {
		fetchPostTable();
		fetchFirstPosts();
		sethp1(<%= @us1.health %>);
		sethp2(<%= @us2.health %>);
	});
</script>

<h3>Posts</h3>
<div id="post_table">
	<table class="table">
	<tr>
		<th><%= @user1.name %></th>
		<th><%= @user2.name %></th>
	</tr>
	<tr>
		<td style="width:400px;">
			<ul>
				<%= render @user1.desc_posts %>
				<% if @user1.posts.empty? %>
					<li>No posts yet...</li>
				<% end %>
			</ul>
		</td>
		<td style="width:400px;">
			<ul>
				<%= render @user2.desc_posts %>
				<% if @user2.posts.empty? %>
					<li>No posts yet...</li>
				<% end %>
			</ul>
		</td>
	</tr>
	</table>
</div>

<%= link_to 'Back to arguments', arguments_path, :class => "btn"%>
<br /><br />
